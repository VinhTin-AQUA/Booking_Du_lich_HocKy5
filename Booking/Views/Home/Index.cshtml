@{
    ViewData["Title"] = "Trang chủ";
}


<link rel="stylesheet" href="~/css/home/home-custom.css" />

<div>
    <div class="search-home-container">
        <div class="row justify-content-center align-items-center m-0">
            <div class="col-12">
                <div class="maintenance-message w-50 mx-auto">
                    <div class="col-12">
                        <form asp-action="SearchTours" asp-controller="Home" method="get">
                            <div class="card">

                                <div class="text-center fs-4 fw-bold my-3 text-primary">
                                    <span>Tìm cuộc phiêu lưu tiếp theo của quý khách</span>
                                </div>

                                <div class="card-body">
                                    <div class="">
                                        <select name="cityName" id="searchSelect" class="form-control w-100">
                                            <option value=""></option>
                                        </select>
                                    </div>
                                </div>

                                <div class="card-footer">
                                    <div class="mt-3">
                                        <button type="submit" class="btn btn-primary"><i class="bi bi-search"></i> Tìm kiếm</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-12 bg-light rounded w-75 city-temp-container">
                <div class="d-flex gap-3 justify-content-between align-items-center">

                    <a asp-action="SearchTours" asp-route-cityName="Hồ Chí Minh" class="product-card city-temp-item d-block">
                        <img class="product-card-img-top" src="https://pix6.agoda.net/geo/city/13170/1_13170_02.jpg?ca=6&ce=1&s=396x298&ar=4x3" alt="Bootstrap Gallery">
                        <div class="product-card-body ">
                            <h5 class="product-title">
                                Hồ Chí Minh
                            </h5>
                        </div>
                    </a>

                    <a asp-action="SearchTours" asp-route-cityName="Hà Nội" class="product-card city-temp-item d-block">
                        <img class="product-card-img-top" src="https://pix6.agoda.net/geo/city/2758/065f4f2c9fa263611ab65239ecbeaff7.jpg?ce=0&s=396x298&ar=4x3" alt="Bootstrap Gallery">
                        <div class="product-card-body">
                            <h5 class="product-title">Hà Nội</h5>
                        </div>
                    </a>

                    <a asp-action="SearchTours" asp-route-cityName="Vũng Tàu" class="product-card city-temp-item d-block">
                        <img class="product-card-img-top" src="https://pix6.agoda.net/geo/city/17190/1_17190_02.jpg?ca=6&ce=1&s=396x298&ar=4x3" alt="Bootstrap Gallery">
                        <div class="product-card-body">
                            <h5 class="product-title">Vũng Tàu</h5>
                        </div>
                    </a>

                    <a asp-action="SearchTours" asp-route-cityName="Đà Nẵng" class="product-card city-temp-item d-block">
                        <img class="product-card-img-top" src="https://pix6.agoda.net/geo/city/16440/1_16440_02.jpg?ca=6&ce=1&s=396x298&ar=4x3" alt="Bootstrap Gallery">
                        <div class="product-card-body">
                            <h5 class="product-title">Đà Nẵng</h5>
                        </div>
                    </a>

                    <a asp-action="SearchTours" asp-route-cityName="Thiên Huế" class="product-card city-temp-item d-block">
                        <img class="product-card-img-top" src="https://pix6.agoda.net/geo/city/15932/1_15932_02.jpg?ca=6&ce=1&s=396x298&ar=4x3" alt="Bootstrap Gallery">
                        <div class="product-card-body">
                            <h5 class="product-title">Thiên Huế</h5>
                        </div>
                    </a>

                    <a asp-action="SearchTours" asp-route-cityName="Khánh Hòa" class="product-card city-temp-item d-block">
                        <img class="product-card-img-top" src="https://pix6.agoda.net/geo/city/2679/1_2679_02.jpg?ca=6&ce=1&s=396x298&ar=4x3" alt="Bootstrap Gallery">
                        <div class="product-card-body">
                            <h5 class="product-title">Khánh Hòa</h5>
                        </div>
                    </a>

                </div>
            </div>

        </div>
        <!-- Row end -->
    </div>

    <!-- một số tour cho 1 vài địa điểm -->

    <div class="card container mx-auto">
        <div class="card-header ">
            <div class="card-title w-100 text-center fs-4">Những địa điểm nổi bật được đề xuất cho quý khách</div>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="custom-badge-group">
                    <div class="mx-auto">
                        <span id="hcm" class="badge city-item fs-6 active-city-item" onclick="onSelectCity('Hồ Chí Minh','hcm')">Hồ Chí Minh</span>
                        <span id="hn" class="badge city-item fs-6" onclick="onSelectCity('Hà Nội','hn')">Hà Nội</span>
                        <span id="vt" class="badge city-item fs-6" onclick="onSelectCity('Vũng Tàu','vt')">Vũng Tàu</span>
                        <span id="dn" class="badge city-item fs-6" onclick="onSelectCity('Đà Nẵng','dn')">Đà Nẵng</span>
                        <span id="kh" class="badge city-item fs-6" onclick="onSelectCity('Khánh Hòa','kh')">Khánh Hòa</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card-body">

            <!-- Row start -->
            <div id="tour-items-container" class="row">



                @* <div class="col-xxl-3 col-md-4 col-sm-6 col-12">
                    <div class="product-card">
                        <img class="product-card-img-top" src="~/assets/admin-layout/images/food/img6.jpg" alt="Bootstrap Gallery">
                        <div class="product-card-body">
                            <h5 class="product-title limited-lines">Green Salad dgd rhgrgh dgihdrgmn gdrhgdrg udrghdrg wa weurgg dgsuyr9 dgiurhga</h5>
                            <div class="product-price">
                                <span class="disount-price">VNĐ 20</span>
                            </div>
                            <div class="product-description limited-lines">
                                Xuartz movement, manufactured by Zitizen watch co., ltd.
                            </div>
                            <div class="product-actions">
                                <button class="btn btn-success addToCart">Xem</button>
                            </div>
                        </div>
                    </div>

                </div> *@

            </div>
            <!-- Row end -->

        </div>
    </div>
</div>

@section Scripts
{
    <script>

        $(document).ready(function () {
            let cityNames = [];

            loadTourOutStanding('Hồ Chí Minh');

            $.ajax({
                url: '@Url.Action("GetAllCities", "City")',
                type: 'GET',
                dataType: 'json',
                data: { key: 'value' },
                success: function (data) {

                    cityNames = data.cityNames;
                    $("#searchSelect").select2({
                        data: cityNames,
                        placeholder: "Nhập tên thành phố",
                        allowClear: true,
                        selectionCssClass: "w-100"
                    });

                    
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    // Xử lý lỗi
                    console.log('AJAX Error:', textStatus, errorThrown);

                    // Chi tiết lỗi từ đối tượng jqXHR
                    console.log('Status Code:', jqXHR.status);
                    console.log('Response Text:', jqXHR.responseText);
                }
            });
        });

        function onSelectCity(cityName, id) {
            let cityItemMenu = document.querySelectorAll('.city-item');
            let cityItemActive = document.getElementById(id);

            for (let item of cityItemMenu) {
                item.classList.remove('active-city-item');
            }

            cityItemActive.classList.add('active-city-item');
            loadTourOutStanding(cityName);
        }

        function loadTourOutStanding(cityName) {
            let cityItemsRef = document.getElementById("tour-items-container");
            cityItemsRef.innerHTML = "";

            $.ajax({
                url: '@Url.Action("GetTourOutStanding", "Home")',
                type: 'GET',
                dataType: 'json',
                data: { cityName: cityName },

                success: function (data) {

                    if (data.status === true) {

                        for (let item of data.tourOutstanding) {
                            // Tạo phần tử div với class "col-xxl-3 col-md-4 col-sm-6 col-12"
                            var colDiv = document.createElement("div");
                            colDiv.className = "col-xxl-3 col-md-4 col-sm-6 col-12";

                            // Tạo phần tử div với class "product-card"
                            var productCardDiv = document.createElement("div");
                            productCardDiv.className = "product-card";

                            // Tạo phần tử img với class "product-card-img-top" và thuộc tính src
                            var imgElement = document.createElement("img");
                            imgElement.className = "product-card-img-top";
                            imgElement.src = item.imgUrl;
                            imgElement.alt = "Bootstrap Gallery";
                            imgElement.style.width = "296px"
                            imgElement.style.height = "197px"

                            // Tạo phần tử div với class "product-card-body"
                            var productCardBodyDiv = document.createElement("div");
                            productCardBodyDiv.className = "product-card-body";

                            // Tạo phần tử h5 với class "product-title limited-lines" và văn bản
                            var titleElement = document.createElement("h5");
                            titleElement.className = "product-title limited-lines";
                            titleElement.textContent = item.tourName;

                            // Tạo phần tử div với class "product-price"
                            var priceDiv = document.createElement("div");
                            priceDiv.className = "product-price";

                            // Tạo phần tử span với class "disount-price" và văn bản
                            var priceSpan = document.createElement("span");
                            priceSpan.className = "disount-price";
                            priceSpan.textContent = item.price + " VNĐ";

                            // Tạo phần tử div với class "product-description limited-lines" và văn bản
                            var descriptionDiv = document.createElement("div");
                            descriptionDiv.className = "product-description limited-lines";
                            descriptionDiv.textContent = item.overview;

                            // Tạo phần tử div với class "product-actions"
                            var actionsDiv = document.createElement("div");
                            actionsDiv.className = "product-actions";

                            // Tạo phần tử button với class "btn btn-primary addToCart" và văn bản
                            var linkElement = document.createElement("a");
                            linkElement.className = "btn btn-primary addToCart";
                            linkElement.textContent = "Xem";
                            linkElement.href = "https://localhost:7231/tour-detail/" + item.tourId;


                            // Gắn các phần tử con vào nhau theo cấu trúc của mã HTML
                            actionsDiv.appendChild(linkElement);
                            priceDiv.appendChild(priceSpan);
                            productCardBodyDiv.appendChild(titleElement);
                            productCardBodyDiv.appendChild(priceDiv);
                            productCardBodyDiv.appendChild(descriptionDiv);
                            productCardBodyDiv.appendChild(actionsDiv);
                            productCardDiv.appendChild(imgElement);
                            productCardDiv.appendChild(productCardBodyDiv);
                            colDiv.appendChild(productCardDiv);

                            // Gắn phần tử cha vào body của trang
                            cityItemsRef.appendChild(colDiv);
                        }
                    }
                },

                error: function (jqXHR, textStatus, errorThrown) {
                    // Xử lý lỗi
                    console.log('AJAX Error:', textStatus, errorThrown);

                    // Chi tiết lỗi từ đối tượng jqXHR
                    console.log('Status Code:', jqXHR.status);
                    console.log('Response Text:', jqXHR.responseText);
                }
            });
        }

    </script>
}

